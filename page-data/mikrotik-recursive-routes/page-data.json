{"componentChunkName":"component---src-templates-blog-post-js","path":"/mikrotik-recursive-routes/","result":{"data":{"site":{"siteMetadata":{"title":"0xdeface.github.io"}},"markdownRemark":{"id":"ef35d9d1-e503-55ef-af09-49aedc258130","excerpt":"Короткий лайфхак, как используя рекурсивный роутинг можно сделать высокодоступное интернет подключение Исходные данные Имеем устройство на базе RouterOS,…","html":"<p>Короткий лайфхак, как используя рекурсивный роутинг можно сделать высокодоступное интернет подключение</p>\n<h2>Исходные данные</h2>\n<p>Имеем устройство на базе RouterOS, 2 шлюза для выхода в интернет</p>\n<h2>Задача</h2>\n<p>При отказе первого шлюза пустить трафик через второй</p>\n<h2>Проблема</h2>\n<p>В голову приходит решение на базе расстояния маршрутов, сделаем два маршрута\n<code class=\"language-text\">0.0.0.0/0.0.0.0 gw ip_isp1 distanse 1 0.0.0.0/0.0.0.0 gw ip_isp 2 distane 2</code>\nиспользуем check gateway в первом маршруте и он отключится при недоступности первого шлюза.\nПроблема кроется в том, что такая проверка не гарантируем наличие выхода в глобальную сеть\nза шлюзом 1, мы лишь ориентируемся на его доступность.</p>\n<h2>Решение</h2>\n<p>Воспользуемся рекурсивными маршрутами и опциями scope, target-scope.\n<strong>Вводная информация:</strong> при совпадении маршрута, если требуется дальнейший поиск в таблице\nмаршрутизации поиск идет среди маршрутов со значением scope равным или меньшим\ntarget-scope найденного маршрута. Используем высокодоступный интернет адрес,\nнапример 8.8.4.4 Напишем маршрут <code class=\"language-text\">0.0.0.0 gw 8.8.4.4 check gateway ping</code>\n(target-scope по умолчанию 10) Напишем маршрут до.8.8.4.4 gw ip<em>isp1 scope=10\n(явно укажем scope поскольку по умолчанию она 30)\nНапишем резервный маршрут `0.0.0.0 gw ip</em>isp2 dst=2` Профит</p>\n<h2>Как это работает</h2>\n<p>Маршрутизатор ищет первый маршрут с меньшим distanse для пакетов наружу.\nМаршрут есть, но не понятно как добратся до 8.8.4.4 поиск будет продолжен\nНайден маршрут до 8.8.4.4 и определен исходящий интерфейс.\nЕсли 8.8.4.4 не будет доступен, пакеты пойдут через резервный маршрут.</p>","frontmatter":{"title":"Mikrotik рекурсивные маршруты","date":"May 06, 2021","description":null}},"previous":{"fields":{"slug":"/hello-world/"},"frontmatter":{"title":"Hello World"}},"next":{"fields":{"slug":"/mikrotik-dynamic-list/"},"frontmatter":{"title":"Mikrotik dynamic address list"}}},"pageContext":{"id":"ef35d9d1-e503-55ef-af09-49aedc258130","previousPostId":"586174ce-d1cb-5783-b6f3-259b74adc422","nextPostId":"7c15ce7c-6dcf-552a-983b-da53f4d59eec"}},"staticQueryHashes":["2841359383","3257411868"]}